<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>まんがジェネレーター</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='icon.png') }}?v=2">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='icon.png') }}?v=2">
    <link rel="manifest" href="{{ url_for('static', filename='../manifest.json') }}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <header>
            <h1>🎨 まんがジェネレーター</h1>
            <a href="/logout" class="logout-btn">ログアウト</a>
        </header>

        <!-- API Key Section -->
        <div class="section api-key-section">
            <label for="apiKey">Gemini APIキー</label>
            <input type="password" id="apiKey" placeholder="APIキーを入力してください" class="api-key-input">
        </div>

        <!-- Common Settings -->
        <div class="section">
            <h2>共通設定</h2>

            <div class="form-group">
                <label for="artStyle">画風</label>
                <input type="text" id="artStyle" placeholder="例：水彩風、アニメ風、リアル調">
            </div>

            <div class="form-group">
                <label>背景</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="background" value="upload">
                        <span>画像アップロード</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="background" value="text" checked>
                        <span>自由入力</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="background" value="white">
                        <span>背景白</span>
                    </label>
                </div>
                <input type="file" id="backgroundUpload" accept="image/*" style="display: none;">
                <input type="text" id="backgroundText" placeholder="背景の説明を入力">
            </div>

            <div class="form-group">
                <label>アスペクト比</label>
                <div class="aspect-ratio-group">
                    <button type="button" class="btn btn-aspect active" data-ratio="1:1">1:1</button>
                    <button type="button" class="btn btn-aspect" data-ratio="2:3">2:3</button>
                    <button type="button" class="btn btn-aspect" data-ratio="16:9">16:9</button>
                </div>
            </div>

            <div class="form-group">
                <label for="story">ストーリー内容</label>
                <textarea id="story" rows="3" placeholder="シーンやストーリーの説明を入力"></textarea>
            </div>

            <div class="form-group">
                <label>セリフ</label>
                <div class="readonly-field">なし（固定）</div>
            </div>

            <h3>共通構図オプション</h3>

            <div class="form-group">
                <label for="distance">距離・範囲</label>
                <select id="distance">
                    <option value="指定なし">指定なし</option>
                    <option value="超接写/マクロ">超接写/マクロ（細部を大きく映す）</option>
                    <option value="顔のアップ">顔のアップ（顔全体）</option>
                    <option value="バストアップ">バストアップ（胸から上）</option>
                    <option value="ウェストアップ">ウェストアップ（腰から上）</option>
                    <option value="ニーアップ/膝上">ニーアップ/膝上（膝から上）</option>
                    <option value="全身">全身（頭から足まで）</option>
                    <option value="ロングショット/遠景">ロングショット/遠景（周囲含む引き）</option>
                    <option value="超遠景/ワイドショット">超遠景/ワイドショット（広い範囲）</option>
                </select>
            </div>

            <div class="form-group">
                <label for="angle">アングル</label>
                <select id="angle">
                    <option value="指定なし">指定なし</option>
                    <option value="アイレベル">アイレベル（目線の高さ）</option>
                    <option value="ローアングル/煽り">ローアングル/煽り（下から見上げる）</option>
                    <option value="ワームズアイ/虫の目線">ワームズアイ/虫の目線（極端に低い位置から）</option>
                    <option value="ハイアングル/俯瞰">ハイアングル/俯瞰（上から見下ろす）</option>
                    <option value="バーズアイ/鳥の目線">バーズアイ/鳥の目線（高い位置から）</option>
                    <option value="トップダウン/真上">トップダウン/真上（真上から見下ろす）</option>
                    <option value="ダッチアングル">ダッチアングル（カメラを傾ける）</option>
                </select>
            </div>

            <div class="form-group">
                <label for="lens">レンズ・効果</label>
                <select id="lens">
                    <option value="指定なし">指定なし</option>
                    <option value="魚眼レンズ">魚眼レンズ（歪んだ広角）</option>
                    <option value="広角レンズ">広角レンズ（広い範囲を撮影）</option>
                    <option value="望遠レンズ/圧縮効果">望遠レンズ/圧縮効果（遠近感圧縮）</option>
                    <option value="被写界深度/背景ボケ">被写界深度/背景ボケ（後ろをぼかす）</option>
                    <option value="モーションブラー">モーションブラー（動きのブレ）</option>
                </select>
            </div>

            <div class="form-group">
                <label for="multiPerson">多人数・関係</label>
                <select id="multiPerson">
                    <option value="指定なし">指定なし</option>
                    <option value="ツーショット">ツーショット（2人を同時に映す）</option>
                    <option value="肩越し/OTS">肩越し/OTS（相手の肩越しに見る）</option>
                    <option value="背中合わせ">背中合わせ（背中を向き合う）</option>
                </select>
            </div>

            <div class="form-group">
                <label for="special">特殊演出</label>
                <select id="special">
                    <option value="指定なし">指定なし</option>
                    <option value="シルエット">シルエット（影絵風）</option>
                    <option value="アイソメトリック">アイソメトリック（等角投影図）</option>
                    <option value="セルフィー/自撮り">セルフィー/自撮り（自分撮り風）</option>
                    <option value="リフレクション/反射">リフレクション/反射（鏡映し）</option>
                    <option value="パースペクティブ強調">パースペクティブ強調（遠近感強調）</option>
                </select>
            </div>
        </div>

        <!-- Character Settings -->
        <div class="section">
            <h2>キャラクター詳細設定</h2>

            <!-- Character 1 -->
            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>キャラ1（主人公）</span>
                    <span class="accordion-icon">▼</span>
                </div>
                <div class="accordion-content">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="char-enable" data-char="1" checked>
                            <span>有効化</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label>キャラ三面図</label>
                        <input type="file" class="char-image" data-char="1" accept="image/*">
                    </div>

                    <div class="form-group">
                        <label>名前</label>
                        <input type="text" class="char-name" data-char="1" placeholder="キャラクター名">
                    </div>

                    <div class="form-group">
                        <label>見た目プロンプト</label>
                        <input type="text" class="char-appearance" data-char="1" placeholder="空欄時はおまかせ">
                    </div>

                    <div class="form-group">
                        <label>表情</label>
                        <input type="text" class="char-expression" data-char="1" placeholder="空欄時はおまかせ">
                    </div>

                    <div class="form-group">
                        <label>オノマトペ</label>
                        <input type="text" class="char-onomatopoeia" data-char="1" placeholder="例：ドキドキ">
                    </div>

                    <div class="form-group">
                        <label>コマ内のキャラ位置</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="char1Position" value="左">
                                <span>左</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char1Position" value="真ん中" checked>
                                <span>真ん中</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char1Position" value="右">
                                <span>右</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>顔の向き</label>
                        <select class="char-face-direction" data-char="1">
                            <option value="指定なし">指定なし</option>
                            <option value="正面/カメラ目線">正面/カメラ目線（真正面）</option>
                            <option value="斜め向き(右)">斜め向き(右)（やや右向き）</option>
                            <option value="斜め向き(左)">斜め向き(左)（やや左向き）</option>
                            <option value="横顔(右)">横顔(右)（完全に右向き）</option>
                            <option value="横顔(左)">横顔(左)（完全に左向き）</option>
                            <option value="背面/後頭部">背面/後頭部（後ろ向き）</option>
                            <option value="振り返る">振り返る（後ろを振り向く）</option>
                            <option value="見上げる">見上げる（上を見る）</option>
                            <option value="俯く">俯く（下を向く）</option>
                            <option value="小首をかしげる">小首をかしげる（首を傾ける）</option>
                            <option value="顎を上げる">顎を上げる（偉そうに）</option>
                            <option value="顎を引く">顎を引く（控えめに）</option>
                            <option value="視線を逸らす">視線を逸らす（目を合わせない）</option>
                            <option value="目を閉じる">目を閉じる（目をつぶる）</option>
                            <option value="お互いを見る">お互いを見る（見つめ合う）</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>体の向き</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="char1BodyOrient" value="右">
                                <span>右</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char1BodyOrient" value="左">
                                <span>左</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char1BodyOrient" value="正面" checked>
                                <span>正面</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char1BodyOrient" value="真ん中">
                                <span>真ん中</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>体の動き</label>
                        <input type="text" class="char-body-movement" data-char="1" placeholder="例：走っている">
                    </div>

                    <div class="form-group">
                        <label>方向・視点</label>
                        <select class="char-direction" data-char="1">
                            <option value="指定なし">指定なし</option>
                            <option value="正面">正面（真正面から）</option>
                            <option value="横顔/サイドビュー">横顔/サイドビュー（真横から）</option>
                            <option value="斜め向き">斜め向き（斜め方向から）</option>
                            <option value="後ろ姿">後ろ姿（背中側から）</option>
                            <option value="主観視点">主観視点（一人称視点）</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>配置・構図</label>
                        <select class="char-composition" data-char="1">
                            <option value="指定なし">指定なし</option>
                            <option value="三分割法">三分割法（交点に配置する基本構図）</option>
                            <option value="日の丸構図/センター配置">日の丸構図/センター配置（中央配置）</option>
                            <option value="シンメトリー/対称">シンメトリー/対称（左右対称）</option>
                            <option value="リーディングライン">リーディングライン（視線誘導線）</option>
                            <option value="ネガティブスペース/余白">ネガティブスペース/余白（空間を活かす）</option>
                            <option value="黄金比">黄金比（美的比率）</option>
                            <option value="フレーム・イン・フレーム">フレーム・イン・フレーム（枠の中の枠）</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ライティング</label>
                        <select class="char-lighting" data-char="1">
                            <option value="指定なし">指定なし</option>
                            <option value="逆光">逆光（後ろから光）</option>
                            <option value="リムライト">リムライト（輪郭が光る）</option>
                            <option value="サイドライト">サイドライト（横から光）</option>
                            <option value="レンブラントライト">レンブラントライト（斜め45度の光）</option>
                            <option value="ボリューメトリックライト">ボリューメトリックライト（光の筋）</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Character 2 -->
            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>キャラ2</span>
                    <span class="accordion-icon">▼</span>
                </div>
                <div class="accordion-content" style="display: none;">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="char-enable" data-char="2">
                            <span>有効化</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label>キャラ三面図</label>
                        <input type="file" class="char-image" data-char="2" accept="image/*">
                    </div>

                    <div class="form-group">
                        <label>名前</label>
                        <input type="text" class="char-name" data-char="2" placeholder="キャラクター名">
                    </div>

                    <div class="form-group">
                        <label>見た目プロンプト</label>
                        <input type="text" class="char-appearance" data-char="2" placeholder="空欄時はおまかせ">
                    </div>

                    <div class="form-group">
                        <label>表情</label>
                        <input type="text" class="char-expression" data-char="2" placeholder="空欄時はおまかせ">
                    </div>

                    <div class="form-group">
                        <label>オノマトペ</label>
                        <input type="text" class="char-onomatopoeia" data-char="2" placeholder="例：ドキドキ">
                    </div>

                    <div class="form-group">
                        <label>コマ内のキャラ位置</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="char2Position" value="左">
                                <span>左</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char2Position" value="真ん中" checked>
                                <span>真ん中</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char2Position" value="右">
                                <span>右</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>顔の向き</label>
                        <select class="char-face-direction" data-char="2">
                            <option value="指定なし">指定なし</option>
                            <option value="正面/カメラ目線">正面/カメラ目線</option>
                            <option value="斜め向き(右)">斜め向き(右)</option>
                            <option value="斜め向き(左)">斜め向き(左)</option>
                            <option value="横顔(右)">横顔(右)</option>
                            <option value="横顔(左)">横顔(左)</option>
                            <option value="背面/後頭部">背面/後頭部</option>
                            <option value="振り返る">振り返る</option>
                            <option value="見上げる">見上げる</option>
                            <option value="俯く">俯く</option>
                            <option value="小首をかしげる">小首をかしげる</option>
                            <option value="顎を上げる">顎を上げる</option>
                            <option value="顎を引く">顎を引く</option>
                            <option value="視線を逸らす">視線を逸らす</option>
                            <option value="目を閉じる">目を閉じる</option>
                            <option value="お互いを見る">お互いを見る</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>体の向き</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="char2BodyOrient" value="右">
                                <span>右</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char2BodyOrient" value="左">
                                <span>左</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char2BodyOrient" value="正面" checked>
                                <span>正面</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char2BodyOrient" value="真ん中">
                                <span>真ん中</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>体の動き</label>
                        <input type="text" class="char-body-movement" data-char="2" placeholder="例：走っている">
                    </div>

                    <div class="form-group">
                        <label>方向・視点</label>
                        <select class="char-direction" data-char="2">
                            <option value="指定なし">指定なし</option>
                            <option value="正面">正面</option>
                            <option value="横顔/サイドビュー">横顔/サイドビュー</option>
                            <option value="斜め向き">斜め向き</option>
                            <option value="後ろ姿">後ろ姿</option>
                            <option value="主観視点">主観視点</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>配置・構図</label>
                        <select class="char-composition" data-char="2">
                            <option value="指定なし">指定なし</option>
                            <option value="三分割法">三分割法</option>
                            <option value="日の丸構図/センター配置">日の丸構図/センター配置</option>
                            <option value="シンメトリー/対称">シンメトリー/対称</option>
                            <option value="リーディングライン">リーディングライン</option>
                            <option value="ネガティブスペース/余白">ネガティブスペース/余白</option>
                            <option value="黄金比">黄金比</option>
                            <option value="フレーム・イン・フレーム">フレーム・イン・フレーム</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ライティング</label>
                        <select class="char-lighting" data-char="2">
                            <option value="指定なし">指定なし</option>
                            <option value="逆光">逆光</option>
                            <option value="リムライト">リムライト</option>
                            <option value="サイドライト">サイドライト</option>
                            <option value="レンブラントライト">レンブラントライト</option>
                            <option value="ボリューメトリックライト">ボリューメトリックライト</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Character 3 -->
            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>キャラ3</span>
                    <span class="accordion-icon">▼</span>
                </div>
                <div class="accordion-content" style="display: none;">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="char-enable" data-char="3">
                            <span>有効化</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label>キャラ三面図</label>
                        <input type="file" class="char-image" data-char="3" accept="image/*">
                    </div>

                    <div class="form-group">
                        <label>名前</label>
                        <input type="text" class="char-name" data-char="3" placeholder="キャラクター名">
                    </div>

                    <div class="form-group">
                        <label>見た目プロンプト</label>
                        <input type="text" class="char-appearance" data-char="3" placeholder="空欄時はおまかせ">
                    </div>

                    <div class="form-group">
                        <label>表情</label>
                        <input type="text" class="char-expression" data-char="3" placeholder="空欄時はおまかせ">
                    </div>

                    <div class="form-group">
                        <label>オノマトペ</label>
                        <input type="text" class="char-onomatopoeia" data-char="3" placeholder="例：ドキドキ">
                    </div>

                    <div class="form-group">
                        <label>コマ内のキャラ位置</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="char3Position" value="左">
                                <span>左</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char3Position" value="真ん中" checked>
                                <span>真ん中</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char3Position" value="右">
                                <span>右</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>顔の向き</label>
                        <select class="char-face-direction" data-char="3">
                            <option value="指定なし">指定なし</option>
                            <option value="正面/カメラ目線">正面/カメラ目線</option>
                            <option value="斜め向き(右)">斜め向き(右)</option>
                            <option value="斜め向き(左)">斜め向き(左)</option>
                            <option value="横顔(右)">横顔(右)</option>
                            <option value="横顔(左)">横顔(左)</option>
                            <option value="背面/後頭部">背面/後頭部</option>
                            <option value="振り返る">振り返る</option>
                            <option value="見上げる">見上げる</option>
                            <option value="俯く">俯く</option>
                            <option value="小首をかしげる">小首をかしげる</option>
                            <option value="顎を上げる">顎を上げる</option>
                            <option value="顎を引く">顎を引く</option>
                            <option value="視線を逸らす">視線を逸らす</option>
                            <option value="目を閉じる">目を閉じる</option>
                            <option value="お互いを見る">お互いを見る</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>体の向き</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="char3BodyOrient" value="右">
                                <span>右</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char3BodyOrient" value="左">
                                <span>左</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char3BodyOrient" value="正面" checked>
                                <span>正面</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="char3BodyOrient" value="真ん中">
                                <span>真ん中</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>体の動き</label>
                        <input type="text" class="char-body-movement" data-char="3" placeholder="例：走っている">
                    </div>

                    <div class="form-group">
                        <label>方向・視点</label>
                        <select class="char-direction" data-char="3">
                            <option value="指定なし">指定なし</option>
                            <option value="正面">正面</option>
                            <option value="横顔/サイドビュー">横顔/サイドビュー</option>
                            <option value="斜め向き">斜め向き</option>
                            <option value="後ろ姿">後ろ姿</option>
                            <option value="主観視点">主観視点</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>配置・構図</label>
                        <select class="char-composition" data-char="3">
                            <option value="指定なし">指定なし</option>
                            <option value="三分割法">三分割法</option>
                            <option value="日の丸構図/センター配置">日の丸構図/センター配置</option>
                            <option value="シンメトリー/対称">シンメトリー/対称</option>
                            <option value="リーディングライン">リーディングライン</option>
                            <option value="ネガティブスペース/余白">ネガティブスペース/余白</option>
                            <option value="黄金比">黄金比</option>
                            <option value="フレーム・イン・フレーム">フレーム・イン・フレーム</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ライティング</label>
                        <select class="char-lighting" data-char="3">
                            <option value="指定なし">指定なし</option>
                            <option value="逆光">逆光</option>
                            <option value="リムライト">リムライト</option>
                            <option value="サイドライト">サイドライト</option>
                            <option value="レンブラントライト">レンブラントライト</option>
                            <option value="ボリューメトリックライト">ボリューメトリックライト</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Generate Button -->
        <button id="generateBtn" class="btn btn-primary btn-large">🎨 画像を生成</button>
        <div id="loadingIndicator" class="loading-indicator" style="display: none;">
            <div class="spinner"></div>
            <p>画像を生成中...</p>
        </div>

        <!-- Prompt Display Section -->
        <div class="section prompt-display" id="promptDisplay" style="display: none;">
            <h2>📝 生成プロンプト</h2>

            <div class="prompt-area">
                <h3>生成プロンプト (English)</h3>
                <textarea id="englishPrompt" readonly rows="8"></textarea>
                <button class="btn btn-secondary copy-btn" onclick="copyPrompt('english')">📋 英語をコピー</button>
            </div>

            <div class="prompt-area">
                <h3>設定・構成メモ (日本語)</h3>
                <textarea id="japaneseSettings" readonly rows="10"></textarea>
                <button class="btn btn-secondary copy-btn" onclick="copyPrompt('japanese')">📋 日本語をコピー</button>
            </div>
        </div>

        <!-- Image Stock -->
        <div class="section">
            <h2>画像ストック</h2>
            <div id="imageStock" class="image-gallery">
                <p class="empty-message">まだ画像がありません</p>
            </div>

            <div class="merge-controls">
                <h3>画像を結合</h3>
                <p class="help-text">2枚の画像を選択してください</p>
                <div class="merge-buttons">
                    <button id="mergeVertical" class="btn btn-secondary" disabled>縦に結合</button>
                    <button id="mergeHorizontal" class="btn btn-secondary" disabled>横に結合</button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }
    </script>
</body>

</html>